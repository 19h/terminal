(function(){function n(b){return k([],b)}function u(b){return{data:"string"===typeof b?w(b):b,index:-1,decode:y}.decode()}function k(b,a){var c=0,d=0,e,h;e=0;if(null==a)b.push(192);else switch(typeof a){case "boolean":b.push(a?195:194);break;case "number":a!==a?b.push(203,255,255,255,255,255,255,255,255):Infinity===a?b.push(203,127,240,0,0,0,0,0,0):Math.floor(a)===a?(0>a?-32<=a?b.push(224+a+32):-128<a?b.push(208,a+256):-32768<a?(a+=65536,b.push(209,a>>8,a&255)):-2147483648<a?(a+=4294967296,b.push(210,
a>>>24,a>>16&255,a>>8&255,a&255)):++e:128>a?b.push(a):256>a?b.push(204,a):65536>a?b.push(205,a>>8,a&255):4294967296>a?b.push(206,a>>>24,a>>16&255,a>>8&255,a&255):++e,e&&(d=Math.floor(a/4294967296),c=a&4294967295,b.push(0>a?211:207,d>>24&255,d>>16&255,d>>8&255,d&255,c>>24&255,c>>16&255,c>>8&255,c&255))):(d=r,(c=0>a)&&(a*=-1),e=Math.log(a)/Math.LN2+1023|0,h=Math.floor(a*Math.pow(2,1075-e)).toString(2).slice(1),e=("000000000"+e.toString(2)).slice(-11),c=(+c+e+h).match(z),b.push(203,d[c[0]],d[c[1]],d[c[2]],
d[c[3]],d[c[4]],d[c[5]],d[c[6]],d[c[7]]));break;case "string":c=[];e=a.length;for(d=0;d<e;++d)h=a.charCodeAt(d),128>h?c.push(h&127):2048>h?c.push(h>>>6&31|192,h&63|128):65536>h&&c.push(h>>>12&15|224,h>>>6&63|128,h&63|128);p(b,32,c.length,[160,218,219]);Array.prototype.push.apply(b,c);break;default:if("[object Array]"===Object.prototype.toString.call(a))for(c=a.length,p(b,16,c,[144,220,221]);d<c;++d)k(b,a[d]);else{if(Object.keys)c=Object.keys(a).length;else for(d in a)a.hasOwnProperty(d)&&++c;p(b,
16,c,[128,222,223]);for(d in a)k(b,d),k(b,a[d])}}return b}function y(){var b,a,c=0,d=0,e,d=this.data;e=d[++this.index];if(224<=e)return e-256;if(128>e)return e;144>e?(a=e-128,e=128):160>e?(a=e-144,e=144):192>e&&(a=e-160,e=160);switch(e){case 192:return null;case 194:return!1;case 195:return!0;case 202:return b=f(this,4),c=b&l[32],a=b>>23&255,d=b&8388607,b&&2147483648!==b?255===a?d?NaN:Infinity:(c?-1:1)*(d|8388608)*Math.pow(2,a-127-23):0;case 203:return b=f(this,4),c=b&l[32],a=b>>20&2047,d=b&1048575,
b&&2147483648!==b?2047===a?(f(this,4),d?NaN:Infinity):(c?-1:1)*((d|1048576)*Math.pow(2,a-1023-20)+f(this,4)*Math.pow(2,a-1023-52)):0;case 207:return f(this,4)*Math.pow(2,32)+f(this,4);case 206:return f(this,4);case 205:return f(this,2);case 204:return f(this,1);case 211:return b=0,c=this.data.slice(this.index+1,this.index+9),this.index+=8,c[0]&128&&(++b,c[0]^=255,c[1]^=255,c[2]^=255,c[3]^=255,c[4]^=255,c[5]^=255,c[6]^=255,c[7]^=255),c=72057594037927936*c[0]+281474976710656*c[1]+1099511627776*c[2]+
4294967296*c[3]+16777216*c[4]+65536*c[5]+256*c[6]+c[7],b?-1*(c+1):c;case 210:b=f(this,4);case 209:void 0===b&&(b=f(this,2));case 208:return void 0===b&&(b=f(this,1)),d=4<<(e&3)+1,b<l[d]?b:b-2*l[d];case 219:a=f(this,4);case 218:void 0===a&&(a=f(this,2));case 160:c=this.index+1;this.index+=a;b=[];ri=-1;for(a=c+a;c<a;++c)e=d[c],128>e?b[++ri]=e:224>e?b[++ri]=(e&31)<<6|d[++c]&63:240>e&&(b[++ri]=(e&15)<<12|(d[++c]&63)<<6|d[++c]&63);return String.fromCharCode.apply(null,b);case 223:a=f(this,4);case 222:void 0===
a&&(a=f(this,2));case 128:for(b={};c<a;++c)d=this.decode(),b[d]=this.decode();break;case 221:a=f(this,4);case 220:void 0===a&&(a=f(this,2));case 144:for(b=[];c<a;++c)b.push(this.decode())}return b}function f(b,a){var c=0,d=b.data,e=b.index;switch(a){case 4:c+=16777216*d[++e]+(d[++e]<<16);case 2:c+=d[++e]<<8;case 1:c+=d[++e]}b.index=e;return c}function p(b,a,c,d){c<a?b.push(d[0]+c):65536>c?b.push(d[1],c>>8,c&255):4294967296>c&&b.push(d[2],c>>>24,c>>16&255,c>>8&255,c&255)}function q(b,a,c){function d(){if(4===
g.readyState){var b,d=g.status,e={status:d,ok:200<=d&&300>d};if(!q++){if("PUT"===k)b=e.ok?g.responseText:"";else if(e.ok){if(a.worker&&"undefined"!==typeof Worker){b=new Worker(msgpack.worker);b.onmessage=function(b){c(b.data,a,e)};b.postMessage({method:"unpack",data:g.responseText});h();return}b=w(g.responseText);b=u(b)}t&&t(g,a,e);c(b,a,e);h()}}}function e(b,d){if(!q++){var e={status:d||400,ok:!1};t&&t(g,a,e);c(null,a,e);h(b)}}function h(a){a&&g&&g.abort&&g.abort();f&&(clearTimeout(f),f=0);g=null;
"undefined"!==typeof addEventListener&&removeEventListener("beforeunload",e,!1)}var f=0,k=a.method||"GET",l=a.header||{},n=a.before,t=a.after,p=a.data||null,g="undefined"!==typeof XMLHttpRequest?new XMLHttpRequest:"undefined"!==typeof ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):null,q=0,m,r="GET"===k&&a.binary;try{g.onreadystatechange=d;g.open(k,b,!0);n&&n(g,a);r&&g.overrideMimeType&&g.overrideMimeType("text/plain; charset=x-user-defined");p&&g.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
for(m in l)g.setRequestHeader(m,l[m]);"undefined"!==typeof addEventListener&&addEventListener("beforeunload",e,!1);g.send(p);f=setTimeout(function(){e(1,408)},1E3*(a.timeout||10))}catch(v){e(0,400)}}function w(b){var a=[],c=m,d=b.split(""),e=-1,f;f=d.length;for(b=f%8;b--;)++e,a[e]=c[d[e]];for(b=f>>3;b--;)a.push(c[d[++e]],c[d[++e]],c[d[++e]],c[d[++e]],c[d[++e]],c[d[++e]],c[d[++e]],c[d[++e]]);return a}function v(b){var a=[],c=0,d=-1,e=b.length,f=[0,2,1][b.length%3],c=x,k=A;if("undefined"!==typeof btoa){for(;d<
e;)a.push(c[b[++d]]);return btoa(a.join(""))}for(--e;d<e;)c=b[++d]<<16|b[++d]<<8|b[++d],a.push(k[c>>18&63],k[c>>12&63],k[c>>6&63],k[c&63]);1<f&&(a[a.length-2]="=");0<f&&(a[a.length-1]="=");return a.join("")}/MSIE/.test(navigator.userAgent);var r={},m={},x={},A="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),l={8:128,16:32768,32:2147483648},z=/.{8}/g;self.importScripts&&(onmessage=function(b){"pack"===b.data.method?postMessage(v(n(b.data.data))):postMessage(u(b.data.data))});
(function(){for(var b=0,a;256>b;++b)a=String.fromCharCode(b),r[("0000000"+b.toString(2)).slice(-8)]=b,m[a]=b,x[b]=a;for(b=128;256>b;++b)m[String.fromCharCode(63232+b)]=b})();module.exports={pack:n,unpack:u,worker:"msgpack.js",upload:function(b,a,c){a.method="PUT";a.binary=!0;if(a.worker&&"undefined"!==typeof Worker){var d=new Worker(msgpack.worker);d.onmessage=function(d){a.data=d.data;q(b,a,c)};d.postMessage({method:"pack",data:a.data})}else a.data=v(n(a.data)),q(b,a,c)},download:function(b,a,c){a.method=
"GET";a.binary=!0;q(b,a,c)}}})();
