!function t(e,n,r){function i(o,f){if(!n[o]){if(!e[o]){var u="function"==typeof require&&require;if(!f&&u)return u(o,!0);if(s)return s(o,!0);var a=new Error("Cannot find module '"+o+"'");throw a.code="MODULE_NOT_FOUND",a}var h=n[o]={exports:{}};e[o][0].call(h.exports,function(t){var n=e[o][1][t];return i(n?n:t)},h,h.exports,t,e,n,r)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<r.length;o++)i(r[o]);return i}({1:[function(t,e){function n(t,e){for(var n in t)e[n]=t[n]}var r={};e.exports=r,r.from=t("./from.js"),r.to=t("./to.js"),r.is=t("./is.js"),r.subarray=t("./subarray.js"),r.join=t("./join.js"),r.copy=t("./copy.js"),r.create=t("./create.js"),n(t("./read.js"),r),n(t("./write.js"),r)},{"./copy.js":3,"./create.js":4,"./from.js":5,"./is.js":6,"./join.js":7,"./read.js":9,"./subarray.js":10,"./to.js":11,"./write.js":12}],2:[function(t,e){!function(){"use strict";function t(t){var e,n,i,s,o,f;if(t.length%4>0)throw"Invalid string. Length must be a multiple of 4";for(o=t.indexOf("="),o=o>0?t.length-o:0,f=[],i=o>0?t.length-4:t.length,e=0,n=0;i>e;e+=4,n+=3)s=r.indexOf(t[e])<<18|r.indexOf(t[e+1])<<12|r.indexOf(t[e+2])<<6|r.indexOf(t[e+3]),f.push((16711680&s)>>16),f.push((65280&s)>>8),f.push(255&s);return 2===o?(s=r.indexOf(t[e])<<2|r.indexOf(t[e+1])>>4,f.push(255&s)):1===o&&(s=r.indexOf(t[e])<<10|r.indexOf(t[e+1])<<4|r.indexOf(t[e+2])>>2,f.push(s>>8&255),f.push(255&s)),f}function n(t){function e(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}var n,i,s,o=t.length%3,f="";for(n=0,s=t.length-o;s>n;n+=3)i=(t[n]<<16)+(t[n+1]<<8)+t[n+2],f+=e(i);switch(o){case 1:i=t[t.length-1],f+=r[i>>2],f+=r[i<<4&63],f+="==";break;case 2:i=(t[t.length-2]<<8)+t[t.length-1],f+=r[i>>10],f+=r[i>>4&63],f+=r[i<<2&63],f+="="}return f}var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";e.exports.toByteArray=t,e.exports.fromByteArray=n}()},{}],3:[function(t,e){function n(t,e,n,s,o){return n=arguments.length<3?0:n,s=arguments.length<4?0:s,o=arguments.length<5?t.length:o,o!==s&&0!==e.length&&0!==t.length?(o>t.length&&(o=t.length),e.length-n<o-s&&(o=e.length-n+s),t.buffer!==e.buffer?r(t,e,n,s,o):i(t,e,n,s,o)):void 0}function r(t,e,n,r,i){for(var s=i-r+n,o=n,f=r;s>o;++o,++f)e[o]=t[f]}function i(t,e,n,r,i){for(var o=i+r,f=new Uint8Array(s.call(t,r,o)),u=0;o>r;++r,++u)e[n++]=f[u]}e.exports=n;var s=[].slice},{}],4:[function(t,e){e.exports=function(t){return new Uint8Array(t)}},{}],5:[function(t,e){function n(t,e){return Array.isArray(t)?new Uint8Array(t):a[e||"utf8"](t)}function r(t){for(var e=t.length/2,n=new Uint8Array(e),r="",i=0,s=t.length;s>i;++i)r+=t.charAt(i),i>0&&i%2===1&&(n[i>>>1]=parseInt(r,16),r="");return n}function i(t){for(var e,n=[],r=0,i=t.length;i>r;++r)e=o(t,r),e!==!1&&(128>e?n[n.length]=e:s(n,e));return new Uint8Array(n)}function s(t,e){var n,r,i,s,o=e,f=0;do++f;while(o>>>=1);for(n=0|Math.ceil((f-1)/5),r=[0,0,192,224,240,248,252][n],s=[0,0,3,4,5,6,7][n],i|=r,f=7-s+6*(n-1);f;)i|=+!!(e&1<<f)<<7-s,++s,s%8===0&&(t[t.length]=i,i=128,s=2),--f;s&&(i|=+!!(1&e)<<7-s,t[t.length]=i)}function o(t,e){e=e||0;var n,r,i=t.charCodeAt(e);if(i>=55296&&56319>=i){if(n=t.charCodeAt(e+1),r=i,isNaN(n))throw new Error("High surrogate not followed by low surrogate");return 1024*(r-55296)+(n-56320)+65536}return i>=56320&&57343>=i?!1:i}function f(t){return new Uint8Array(u.toByteArray(t))}e.exports=n;var u=t("base64-js"),a={hex:r,utf8:i,base64:f}},{"base64-js":2}],6:[function(t,e){e.exports=function(t){return t instanceof Uint8Array}},{}],7:[function(t,e){function n(t,e){if(!t.length)return new Uint8Array(0);for(var n=void 0!==e?e:r(t),i=new Uint8Array(n),s=t[0],o=s.length,f=0,u=0,a=0;n>a;)u!==o?i[a++]=s[u++]:(u=0,++f,s=t[f],o=s&&s.length);return i}function r(t){for(var e=0,n=0,r=t.length;r>n;++n)e+=t[n].byteLength;return e}e.exports=n},{}],8:[function(t,e){function n(t){return new DataView(t.buffer,0)}function r(t){var e=s.get(t.buffer);return e||s.set(t.buffer,e=new DataView(t.buffer,0)),e}var i,s;e.exports=i={},s="undefined"==typeof WeakMap?null:new WeakMap,i.get=s?r:n},{}],9:[function(t,e){function n(t,e){return t[e]}function r(t,e){var n=t[e];return 128>n?n:n-256}function i(t,e){var n=d.get(t);return n.getUint16(e+t.byteOffset,!0)}function s(t,e){var n=d.get(t);return n.getUint32(e+t.byteOffset,!0)}function o(t,e){var n=d.get(t);return n.getInt16(e+t.byteOffset,!0)}function f(t,e){var n=d.get(t);return n.getInt32(e+t.byteOffset,!0)}function u(t,e){var n=d.get(t);return n.getFloat32(e+t.byteOffset,!0)}function a(t,e){var n=d.get(t);return n.getFloat64(e+t.byteOffset,!0)}function h(t,e){var n=d.get(t);return n.getUint16(e+t.byteOffset,!1)}function c(t,e){var n=d.get(t);return n.getUint32(e+t.byteOffset,!1)}function l(t,e){var n=d.get(t);return n.getInt16(e+t.byteOffset,!1)}function v(t,e){var n=d.get(t);return n.getInt32(e+t.byteOffset,!1)}function p(t,e){var n=d.get(t);return n.getFloat32(e+t.byteOffset,!1)}function m(t,e){var n=d.get(t);return n.getFloat64(e+t.byteOffset,!1)}e.exports={readUInt8:n,readInt8:r,readUInt16LE:i,readUInt32LE:s,readInt16LE:o,readInt32LE:f,readFloatLE:u,readDoubleLE:a,readUInt16BE:h,readUInt32BE:c,readInt16BE:l,readInt32BE:v,readFloatBE:p,readDoubleBE:m};var d=t("./mapped.js")},{"./mapped.js":8}],10:[function(t,e){function n(t,e,n){return t.subarray(e||0,n||t.length)}e.exports=n},{}],11:[function(t,e){function n(t,e){return u[e||"utf8"](t)}function r(t){for(var e,n="",r=0,i=t.length;i>r;++r)e=t[r],n+=((240&e)>>>4).toString(16),n+=(15&e).toString(16);return n}function i(t){return f(t)}function s(t){return o.fromByteArray(t)}e.exports=n;var o=t("base64-js"),f=t("to-utf8"),u={hex:r,utf8:i,base64:s}},{"base64-js":2,"to-utf8":15}],12:[function(t,e){function n(t,e,n){return t[n]=e}function r(t,e,n){return t[n]=0>e?e+256:e}function i(t,e,n){var r=d.get(t);return r.setUint16(n+t.byteOffset,e,!0)}function s(t,e,n){var r=d.get(t);return r.setUint32(n+t.byteOffset,e,!0)}function o(t,e,n){var r=d.get(t);return r.setInt16(n+t.byteOffset,e,!0)}function f(t,e,n){var r=d.get(t);return r.setInt32(n+t.byteOffset,e,!0)}function u(t,e,n){var r=d.get(t);return r.setFloat32(n+t.byteOffset,e,!0)}function a(t,e,n){var r=d.get(t);return r.setFloat64(n+t.byteOffset,e,!0)}function h(t,e,n){var r=d.get(t);return r.setUint16(n+t.byteOffset,e,!1)}function c(t,e,n){var r=d.get(t);return r.setUint32(n+t.byteOffset,e,!1)}function l(t,e,n){var r=d.get(t);return r.setInt16(n+t.byteOffset,e,!1)}function v(t,e,n){var r=d.get(t);return r.setInt32(n+t.byteOffset,e,!1)}function p(t,e,n){var r=d.get(t);return r.setFloat32(n+t.byteOffset,e,!1)}function m(t,e,n){var r=d.get(t);return r.setFloat64(n+t.byteOffset,e,!1)}e.exports={writeUInt8:n,writeInt8:r,writeUInt16LE:i,writeUInt32LE:s,writeInt16LE:o,writeInt32LE:f,writeFloatLE:u,writeDoubleLE:a,writeUInt16BE:h,writeUInt32BE:c,writeInt16BE:l,writeInt32BE:v,writeFloatBE:p,writeDoubleBE:m};var d=t("./mapped.js")},{"./mapped.js":8}],13:[function(t,e){e.exports=function(){var e=t("events"),n={};return n.createDomain=n.create=function(){function t(t){n.emit("error",t)}var n=new e.EventEmitter;return n.add=function(e){e.on("error",t)},n.remove=function(e){e.removeListener("error",t)},n.bind=function(e){return function(){var n=Array.prototype.slice.call(arguments);try{e.apply(null,n)}catch(r){t(r)}}},n.intercept=function(e){return function(n){if(n)t(n);else{var r=Array.prototype.slice.call(arguments,1);try{e.apply(null,r)}catch(n){t(n)}}}},n.run=function(e){try{e()}catch(n){t(n)}return this},n.dispose=function(){return this.removeAllListeners(),this},n.enter=n.exit=function(){return this},n},n}.call(this)},{events:14}],14:[function(t,e){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function i(t){return"number"==typeof t}function s(t){return"object"==typeof t&&null!==t}function o(t){return void 0===t}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(t){if(!i(t)||0>t||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.emit=function(t){var e,n,i,f,u,a;if(this._events||(this._events={}),"error"===t&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if(e=arguments[1],e instanceof Error)throw e;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[t],o(n))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:f=Array.prototype.slice.call(arguments,1),n.apply(this,f)}else if(s(n))for(f=Array.prototype.slice.call(arguments,1),a=n.slice(),i=a.length,u=0;i>u;u++)a[u].apply(this,f);return!0},n.prototype.addListener=function(t,e){var i;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?s(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,s(this._events[t])&&!this._events[t].warned&&(i=o(this._maxListeners)?n.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[t].length>i&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),i||(i=!0,e.apply(this,arguments))}if(!r(e))throw TypeError("listener must be a function");var i=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,i,o,f;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(n=this._events[t],o=n.length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(s(n)){for(f=o;f-->0;)if(n[f]===e||n[f].listener&&n[f].listener===e){i=f;break}if(0>i)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[t],r(n))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},n.prototype.listeners=function(t){var e;return e=this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},n.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},n.listenerCount=function(t,e){return t.listenerCount(e)}},{}],15:[function(t,e){function n(t,e,n){e=void 0===e?0:e,n=void 0===n?t.length:n;var u,h,c=0,l=128,v=0;for(o.length=s.length=0;c<t.length;)h=t[c],!v&&h&l?(u=r(h),v+=u,8>u&&(o[o.length]=h&a[6-u])):v?(o[o.length]=h&a[6],--v,!v&&o.length&&(s[s.length]=f(i(o,u)),o.length=0)):s[s.length]=f(h),++c;return o.length&&!v&&(s[s.length]=f(i(o,u)),o.length=0),s.join("")}function r(t){for(var e=0;7>e&&t&u[e];++e);return e}function i(t){for(var e=0,n=0,r=t.length;r>n;++n)e|=t[n]<<6*(r-n-1);return e}e.exports=n;var s=[],o=[],f=String.fromCharCode,u=[64,32,16,8,4,2,1],a=[0,1,3,7,15,31,63,127]},{}],16:[function(t,e){"use strict";function n(){n.init.call(this)}function r(t){return void 0===t._maxListeners?n.defaultMaxListeners:t._maxListeners}function i(t,e,n){if(e)t.call(n);else{e=t.length,t=c(t,e);for(var r=0;e>r;++r)t[r].call(n)}}function s(t,e,n,r){if(e)t.call(n,r);else{e=t.length,t=c(t,e);for(var i=0;e>i;++i)t[i].call(n,r)}}function o(t,e,n,r,i){if(e)t.call(n,r,i);else{e=t.length,t=c(t,e);for(var s=0;e>s;++s)t[s].call(n,r,i)}}function f(t,e,n,r,i,s){if(e)t.call(n,r,i,s);else{e=t.length,t=c(t,e);for(var o=0;e>o;++o)t[o].call(n,r,i,s)}}function u(t,e,n,r){if(e)t.apply(n,r);else{e=t.length,t=c(t,e);for(var i=0;e>i;++i)t[i].apply(n,r)}}function a(t){var e=this._events;if(e){if(t=e[t],"function"==typeof t)return 1;if(t)return t.length}return 0}function h(t,e){for(var n=e,r=n+1,i=t.length;i>r;n+=1,r+=1)t[n]=t[r];t.pop()}function c(t,e){for(var n=Array(e);e--;)n[e]=t[e];return n}var l;e.exports=n,n.EventEmitter=n,n.usingDomains=!1,n.prototype.domain=void 0,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.init=function(){this.domain=null,n.usingDomains&&(l=l||t("domain"),!l.active||this instanceof l.Domain||(this.domain=l.active)),this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events={},this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(t){if("number"!=typeof t||0>t||isNaN(t))throw new TypeError("n must be a positive number");return this._maxListeners=t,this},n.prototype.getMaxListeners=function(){return r(this)},n.prototype.emit=function(t){var e,n,r,a,h,c;if(e=!1,r="error"===t,n=this._events)r=r&&null==n.error;else if(!r)return!1;if(c=this.domain,r){if(e=arguments[1],!c){if(e instanceof Error)throw e;throw c=Error('Uncaught, unspecified "error" event. ('+e+")"),c.context=e,c}return e||(e=Error('Uncaught, unspecified "error" event.')),e.domainEmitter=this,e.domain=c,e.domainThrown=!1,c.emit("error",e),!1}if(n=n[t],!n)return!1;c&&(c.enter(),e=!0);var l="function"==typeof n;switch(r=arguments.length){case 1:i(n,l,this);break;case 2:s(n,l,this,arguments[1]);break;case 3:o(n,l,this,arguments[1],arguments[2]);break;case 4:f(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(a=Array(r-1),h=1;r>h;h++)a[h-1]=arguments[h];u(n,l,this,a)}return e&&c.exit(),!0},n.prototype.addListener=function(t,e){var n,i;if("function"!=typeof e)throw new TypeError("listener must be a function");return(n=this._events)?(n.newListener&&(this.emit("newListener",t,e.listener?e.listener:e),n=this._events),i=n[t]):(n=this._events={},this._eventsCount=0),i?("function"==typeof i?i=n[t]=[i,e]:i.push(e),i.warned||(n=r(this))&&n>0&&i.length>n&&(i.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d %s listeners added. Use emitter.setMaxListeners() to increase limit.",i.length,t),console.trace())):(n[t]=e,++this._eventsCount),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(t,e){function n(){this.removeListener(t,n),r||(r=!0,e.apply(this,arguments))}if("function"!=typeof e)throw new TypeError("listener must be a function");var r=!1;return n.listener=e,this.on(t,n),this},n.prototype.removeListener=function(t,e){var n,r,i,s;if("function"!=typeof e)throw new TypeError("listener must be a function");if(r=this._events,!r)return this;if(n=r[t],!n)return this;if(n===e||n.listener&&n.listener===e)0===--this._eventsCount?this._events={}:(delete r[t],r.removeListener&&this.emit("removeListener",t,e));else if("function"!=typeof n){for(i=-1,s=n.length;0<s--;)if(n[s]===e||n[s].listener&&n[s].listener===e){i=s;break}if(0>i)return this;if(1===n.length){if(n[0]=void 0,0===--this._eventsCount)return this._events={},this;delete r[t]}else h(n,i);r.removeListener&&this.emit("removeListener",t,e)}return this},n.prototype.removeAllListeners=function(t){var e;if(e=this._events,!e)return this;if(!e.removeListener)return 0===arguments.length?(this._events={},this._eventsCount=0):e[t]&&(0===--this._eventsCount?this._events={}:delete e[t]),this;if(0===arguments.length){e=Object.keys(e);for(var n,r=0;r<e.length;++r)n=e[r],"removeListener"!==n&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events={},this._eventsCount=0,this}if(e=e[t],"function"==typeof e)this.removeListener(t,e);else if(e)do this.removeListener(t,e[e.length-1]);while(e[0]);return this},n.prototype.listeners=function(t){var e=this._events;return t=e&&(t=e[t])?"function"==typeof t?[t]:c(t,t.length):[]},n.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):a.call(t,e)},n.prototype.listenerCount=a},{domain:13}],17:[function(t){"use strict";function e(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function n(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function r(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var s=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=t("./events.js"),f=t("./msgpack.js"),u=t("./sha256.js"),a=function(){function t(e){i(this,t),this.element=document.createElement("line"),this.setMessage(e)}return s(t,[{key:"setMessage",value:function(t){this.element.innerHTML=t}},{key:"getElement",value:function(){return this.element}}]),t}(),h=function(){function t(){i(this,t),this.element=document.createElement("inputline"),this.prompt=document.createElement("prompt"),this.input=document.createElement("input"),this.input.className="command",this.element.appendChild(this.prompt),this.element.appendChild(this.input)}return s(t,[{key:"setDisabled",value:function(t){this.input.setAttribute("disabled",t)}},{key:"setAutofocus",value:function(){this.input.setAttribute("autofocus",!0)}},{key:"setInput",value:function(t){this.input.value=t}},{key:"setPrompt",value:function(t){this.prompt.innerText=t}},{key:"getElement",value:function(){return this.element}}]),t}(),c=function(){function t(e){i(this,t),this.lineFeed=[],this.output=e}return s(t,[{key:"push",value:function(t){this.output.appendChild(t.getElement()),this.lineFeed.push(t)}},{key:"remove",value:function(t){this.output.removeChild(t.getElement());var e=this.lineFeed.indexOf(t);~e&&(this.lineFeed=Array.prototype.concat.call(this.lineFeed.slice(0,e),this.lineFeed.slice(e+1,this.lineFeed.length-1)))}},{key:"removeAllLines",value:function(){var t=this;this.lineFeed.forEach(function(e){return t.remove(e)})}},{key:"removeLastPartial",value:function(){for(var t=this,e=void 0,n=this.lineFeed.length;n>=0;--n)if(this.lineFeed[n]instanceof h){e=this.lineFeed[n];break}void 0!==e&&this.lineFeed.slice(this.lineFeed.indexOf(e)).forEach(function(e){t.remove(e)})}}]),t}(),l=function(t){function e(){i(this,e);var t=n(this,Object.getPrototypeOf(e).call(this));return t.init(),t.registerEvents(),t}return r(e,t),s(e,[{key:"init",value:function(){this.prefixMeta={name:"nobody",instance:"apx",uri:"~"},this.container=this._initContainer(),this.command=this.container.querySelector("inputline .command"),this.output=this.container.querySelector("output"),this.lineFeed=new c(this.output),this.commandFeed=[]}},{key:"_inputLine",value:function(){return new h}},{key:"_getPromptPrefix",value:function(){return this.prefixMeta.name+"@"+this.prefixMeta.instance+":"+this.prefixMeta.uri+"$"}},{key:"_commitPromptPrefix",value:function(){var t=this._getPromptPrefix();this.inputLine.setPrompt(t)}},{key:"_initContainer",value:function(){var t=document.createElement("cream");return t.className="box",this.output=document.createElement("output"),this.inputLine=this._inputLine(),this.inputLine.setAutofocus(!0),this._commitPromptPrefix(),document.body.appendChild(t),t.appendChild(this.output),t.appendChild(this.inputLine.getElement()),t}},{key:"registerEvents",value:function(){var t=this;this.command.addEventListener("keydown",function(e){if(e.metaKey)switch(e.preventDefault(),e.keyCode){case 75:return t.clearTerminal();case 76:return t.partialClearTerminal()}if(13===e.keyCode){switch(t.command.value){case"clear":return t.resetTerminal()}t.disableTerminal(),t.emit("command",t.command.value)}},!0)}},{key:"write",value:function(t){var e=new h;e.setDisabled(!0),e.setInput(this.command.value),e.setPrompt(this._getPromptPrefix()),this.lineFeed.push(e),this.writeRaw(t)}},{key:"writeRaw",value:function(t){var e=this;t=t.split("\n").map(function(t){return t.trim()}),t=t.map(function(t){return new a(t)}),t.forEach(function(t){return e.lineFeed.push(t)})}},{key:"commit",value:function(){this.command.value="",this.command.disabled=!1,this.command.focus(),this.command.scrollIntoView()}},{key:"clearTerminal",value:function(){this.lineFeed.removeAllLines()}},{key:"partialClearTerminal",value:function(){this.lineFeed.removeLastPartial()}},{key:"resetTerminal",value:function(){this.clearTerminal(),this.command.value=""}},{key:"disableTerminal",value:function(){this.command.disabled=!0}},{key:"destroy",value:function(){this.off(),this.clearTerminal(),document.body.removeChild(this.container)}}]),e}(o),v=function(t){function o(){i(this,o);var t=n(this,Object.getPrototypeOf(o).call(this));return t.helpers={bsd16:function(t){for(var e=0,n=0,r=t.length;r>n;n++)e=((e>>>1)+((1&e)<<15)|0)+(255&t[n])&65535|0;return e},arr2uint8:function(t){for(var e=0,n=new Uint8Array(t.length);e<t.length;++e)n[e]=t[e];return n}},t.registerRealtime(),t.setupTTY(),t.reactiveKeychain(),t}return r(o,t),s(o,[{key:"setupTTY",value:function(){this.initTerminal(),this.initKeychain(),localStorage.id&&this.handshake()}},{key:"reset",value:function(){}},{key:"initKeychain",value:function(){this.alice={},this.alice.keypair=sodium.crypto_box_keypair(),this.alice.nonce=sodium.randombytes_buf(sodium.crypto_box_NONCEBYTES);var t=String(location.hash.slice(1));if(""===t)throw this.terminal.writeRaw("Bad secret"),this.terminal.disableTerminal(),new Error;t=u(t),this.alice.secretHash=t,this.alice.authedHandshake=sodium.crypto_auth(this.alice.nonce,t)}},{key:"reactiveKeychain",value:function(){var t=this;window.addEventListener("hashchange",function(){t.terminal.destroy(),t.terminal=null,setTimeout(function(){return t.setupTTY()})})}},{key:"registerRealtime",value:function(){var t=this;this.io=io({path:"/io"});var e=function(e){t.terminal.write(e),t.terminal.commit()};this.io.on("err",e),this.io.on("info",e),this.io.on("post-auth",function(e,n){sodium.crypto_auth_verify(Uint8Array.from(n),t.bob.nonce,t.alice.secretHash)&&(t.authenticated=!0,t.terminal.write("Welcome, "+e+"."),t.terminal.commit())}),this.io.on("rpc",function(e){return t.handleRPC(e)})}},{key:"handleRPC",value:function(t){try{switch(t=f.decode(new Uint8Array(t)),t.type){case"handshake":return this.digestHandshake(t.publicKey,t.nonce)}}catch(e){console.warn("Received invalid RPC frame.",e.stack)}}},{key:"digestHandshake",value:function(t,n){this.bob={publicKey:this.helpers.arr2uint8(t),nonce:this.helpers.arr2uint8(n)};var r=sodium.crypto_box_easy("init",this.alice.nonce,this.bob.publicKey,this.alice.keypair.privateKey);this.io.emit("post-handshake",[].concat(e(r)))}},{key:"handshake",value:function(){var t=localStorage.id,n={user:t,nonce:[].concat(e(this.alice.nonce)),publicKey:[].concat(e(this.alice.keypair.publicKey)),authedHandshake:[].concat(e(this.alice.authedHandshake))},r=String.fromCharCode.apply(null,f.encode(n)),i=this.helpers.bsd16(r);this.io.emit("handshake",r,i)}},{key:"bufcmp",value:function(t,e){if(t.length!==e.length)return!1;for(var n=0;n<e.length;++n)if(t[n]!==e[n])return!1;return!0}},{key:"initTerminal",value:function(){var t=this;this.terminal=new l,this.terminal.on("command",function(e){var n=e.trim().split(" ");t.authenticated?t.io.emit("command",n):2!==n.length||"login"!==n[0]?(t.terminal.write("Not authenticated."),t.terminal.commit()):(localStorage.id=n[1],t.handshake())})}}]),o}(o);new v},{"./events.js":16,"./msgpack.js":18,"./sha256.js":19}],18:[function(t,e,n){"use strict";function r(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function i(t,e){this.offset=e||0,this.buffer=t}function s(t){var e=new i(t),n=e.parse();if(e.offset!==t.length)throw new Error(t.length-e.offset+" trailing bytes");return n}function o(t){return Object.keys(t).filter(function(e){return"function"!=typeof t[e]||t[e].toJSON})}function f(t,e,n){var i,s,u="undefined"==typeof t?"undefined":r(t);if("string"===u){if(t=a.from(t),i=t.length,32>i)return e[n]=160|i,a.copy(t,e,n+1),1+i;if(256>i)return e[n]=217,a.writeUInt8(e,i,n+1),a.copy(t,e,n+2),2+i;if(65536>i)return e[n]=218,a.writeUInt16BE(e,i,n+1),a.copy(t,e,n+3),3+i;if(4294967296>i)return e[n]=219,a.writeUInt32BE(e,i,n+1),a.copy(t,e,n+5),5+i}if(a.is(t)){if(i=t.length,256>i)return e[n]=196,a.writeUInt8(e,i,n+1),a.copy(t,e,n+2),2+i;if(65536>i)return e[n]=216,a.writeUInt16BE(e,i,n+1),a.copy(t,e,n+3),3+i;if(4294967296>i)return e[n]=217,a.writeUInt32BE(e,i,n+1),a.copy(t,e,n+5),5+i}if("number"===u){if(t<<0!==t)return e[n]=203,a.writeDoubleBE(e,t,n+1),9;if(t>=0){if(128>t)return e[n]=t,1;if(256>t)return e[n]=204,e[n+1]=t,2;if(65536>t)return e[n]=205,a.writeUInt16BE(e,t,n+1),3;if(4294967296>t)return e[n]=206,a.writeUInt32BE(e,t,n+1),5;if(0x10000000000000000>t)return e[n]=207,a.writeUInt64BE(e,t,n+1),9;throw new Error("Number too big 0x"+t.toString(16))}if(t>=-32)return a.writeInt8(e,t,n),1;if(t>=-128)return e[n]=208,a.writeInt8(e,t,n+1),2;if(t>=-32768)return e[n]=209,a.writeInt16BE(e,t,n+1),3;if(t>=-2147483648)return e[n]=210,a.writeInt32BE(e,t,n+1),5;if(t>=-0x8000000000000000)return e[n]=211,a.writeInt64BE(e,t,n+1),9;throw new Error("Number too small -0x"+t.toString(16).substr(1))}if("undefined"===u)return e[n]=212,e[n+1]=0,e[n+2]=0,1;if(null===t)return e[n]=192,1;if("boolean"===u)return e[n]=t?195:194,1;if("function"==typeof t.toJSON)return f(t.toJSON(),e,n);if("object"===u){s=0;var h=Array.isArray(t);if(h)i=t.length;else{var c=o(t);i=c.length}if(16>i?(e[n]=i|(h?144:128),s=1):65536>i?(e[n]=h?220:222,a.writeUInt16BE(e,i,n+1),s=3):4294967296>i&&(e[n]=h?221:223,a.writeUInt32BE(e,i,n+1),s=5),h)for(var l=0;i>l;l++)s+=f(t[l],e,n+s);else for(var l=0;i>l;l++){var v=c[l];s+=f(v,e,n+s),s+=f(t[v],e,n+s)}return s}if("function"!==u)throw new Error("Unknown type "+u)}function u(t){var e,n,i="undefined"==typeof t?"undefined":r(t);if("string"===i){if(e=a.from(t).length,32>e)return 1+e;if(256>e)return 2+e;if(65536>e)return 3+e;if(4294967296>e)return 5+e}if(a.is(t)){if(e=t.length,256>e)return 2+e;if(65536>e)return 3+e;if(4294967296>e)return 5+e}if("number"===i){if(t<<0!==t)return 9;if(t>=0){if(128>t)return 1;if(256>t)return 2;if(65536>t)return 3;if(4294967296>t)return 5;if(0x10000000000000000>t)return 9;throw new Error("Number too big 0x"+t.toString(16))}if(t>=-32)return 1;if(t>=-128)return 2;if(t>=-32768)return 3;if(t>=-2147483648)return 5;if(t>=-0x8000000000000000)return 9;throw new Error("Number too small -0x"+t.toString(16).substr(1))}if("boolean"===i||null===t)return 1;if("undefined"===i)return 3;if("function"==typeof t.toJSON)return u(t.toJSON());if("object"===i){if("function"==typeof t.toJSON&&(t=t.toJSON()),n=0,Array.isArray(t)){e=t.length;for(var s=0;e>s;s++)n+=u(t[s])}else{var f=o(t);e=f.length;for(var s=0;e>s;s++){var h=f[s];n+=u(h)+u(t[h])}}if(16>e)return 1+n;if(65536>e)return 3+n;if(4294967296>e)return 5+n;throw new Error("Array or object too long 0x"+e.toString(16))}if("function"===i)return 0;throw new Error("Unknown type "+i)}var a=t("bops");n.encode=function(t){var e=u(t);if(0!==e){var n=a.create(e);return f(t,n,0),n}},n.decode=s,i.prototype.map=function(t){for(var e={},n=0;t>n;n++){var r=this.parse();e[r]=this.parse()}return e},i.prototype.bin=function(t){var e=a.subarray(this.buffer,this.offset,this.offset+t);return this.offset+=t,e},i.prototype.str=function(t){var e=a.to(a.subarray(this.buffer,this.offset,this.offset+t));return this.offset+=t,e},i.prototype.array=function(t){for(var e=new Array(t),n=0;t>n;n++)e[n]=this.parse();return e},i.prototype.parse=function(){var t,e,n,r=this.buffer[this.offset];if(0===(128&r))return this.offset++,r;if(128===(240&r))return e=15&r,this.offset++,this.map(e);if(144===(240&r))return e=15&r,this.offset++,this.array(e);if(160===(224&r))return e=31&r,this.offset++,this.str(e);if(224===(224&r))return t=a.readInt8(this.buffer,this.offset),this.offset++,t;switch(r){case 192:return this.offset++,null;case 194:return this.offset++,!1;case 195:return this.offset++,!0;case 196:return e=a.readUInt8(this.buffer,this.offset+1),this.offset+=2,this.bin(e);case 197:return e=a.readUInt16BE(this.buffer,this.offset+1),this.offset+=3,this.bin(e);case 198:return e=a.readUInt32BE(this.buffer,this.offset+1),this.offset+=5,this.bin(e);case 199:return e=a.readUInt8(this.buffer,this.offset+1),n=a.readUInt8(this.buffer,this.offset+2),this.offset+=3,[n,this.bin(e)];case 200:return e=a.readUInt16BE(this.buffer,this.offset+1),n=a.readUInt8(this.buffer,this.offset+3),this.offset+=4,[n,this.bin(e)];case 201:return e=a.readUInt32BE(this.buffer,this.offset+1),n=a.readUInt8(this.buffer,this.offset+5),this.offset+=6,[n,this.bin(e)];case 202:return t=a.readFloatBE(this.buffer,this.offset+1),this.offset+=5,t;case 203:return t=a.readDoubleBE(this.buffer,this.offset+1),this.offset+=9,t;case 204:return t=this.buffer[this.offset+1],this.offset+=2,t;case 205:return t=a.readUInt16BE(this.buffer,this.offset+1),this.offset+=3,t;case 206:return t=a.readUInt32BE(this.buffer,this.offset+1),this.offset+=5,t;case 207:return t=a.readUInt64BE(this.buffer,this.offset+1),this.offset+=9,t;case 208:return t=a.readInt8(this.buffer,this.offset+1),this.offset+=2,t;case 209:return t=a.readInt16BE(this.buffer,this.offset+1),this.offset+=3,t;case 210:return t=a.readInt32BE(this.buffer,this.offset+1),this.offset+=5,t;case 211:return t=a.readInt64BE(this.buffer,this.offset+1),this.offset+=9,t;case 212:return n=a.readUInt8(this.buffer,this.offset+1),t=a.readUInt8(this.buffer,this.offset+2),this.offset+=3,0===n&&0===t?void 0:[n,t];case 213:return n=a.readUInt8(this.buffer,this.offset+1),this.offset+=2,[n,this.bin(2)];case 214:return n=a.readUInt8(this.buffer,this.offset+1),this.offset+=2,[n,this.bin(4)];case 215:return n=a.readUInt8(this.buffer,this.offset+1),this.offset+=2,[n,this.bin(8)];case 216:return n=a.readUInt8(this.buffer,this.offset+1),this.offset+=2,[n,this.bin(16)];case 217:return e=a.readUInt8(this.buffer,this.offset+1),this.offset+=2,this.str(e);case 218:return e=a.readUInt16BE(this.buffer,this.offset+1),this.offset+=3,this.str(e);case 219:return e=a.readUInt32BE(this.buffer,this.offset+1),this.offset+=5,this.str(e);case 220:return e=a.readUInt16BE(this.buffer,this.offset+1),this.offset+=3,this.array(e);case 221:return e=a.readUInt32BE(this.buffer,this.offset+1),this.offset+=5,this.array(e);case 222:return e=a.readUInt16BE(this.buffer,this.offset+1),this.offset+=3,this.map(e);case 223:return e=a.readUInt32BE(this.buffer,this.offset+1),this.offset+=5,this.map(e);case 216:return e=a.readUInt16BE(this.buffer,this.offset+1),this.offset+=3,this.buf(e);case 217:return e=a.readUInt32BE(this.buffer,this.offset+1),this.offset+=5,this.buf(e)}throw new Error("Unknown type 0x"+r.toString(16))}},{bops:1}],19:[function(t,e){"use strict";var n=[-2147483648,8388608,32768,128],r=[24,16,8,0],i=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=[];

e.exports=function(t){var e="string"!=typeof t;e&&t.constructor==ArrayBuffer&&(t=new Uint8Array(t));var o,f,u,a,h,c,l,v,p,m,d,y,g,b,w,E,_,L,x,I,U,k,O=!0,A=!1,B=0,j=0,C=0,T=t.length;o=1779033703,f=3144134277,u=1013904242,a=2773480762,h=1359893119,c=2600822924,l=528734635,v=1541459225,p=0;do{if(s[0]=p,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0,e)for(d=j;T>B&&64>d;++B)s[d>>2]|=t[B]<<r[3&d++];else for(d=j;T>B&&64>d;++B)m=t.charCodeAt(B),128>m?s[d>>2]|=m<<r[3&d++]:2048>m?(s[d>>2]|=(192|m>>6)<<r[3&d++],s[d>>2]|=(128|63&m)<<r[3&d++]):55296>m||m>=57344?(s[d>>2]|=(224|m>>12)<<r[3&d++],s[d>>2]|=(128|m>>6&63)<<r[3&d++],s[d>>2]|=(128|63&m)<<r[3&d++]):(m=65536+((1023&m)<<10|1023&t.charCodeAt(++B)),s[d>>2]|=(240|m>>18)<<r[3&d++],s[d>>2]|=(128|m>>12&63)<<r[3&d++],s[d>>2]|=(128|m>>6&63)<<r[3&d++],s[d>>2]|=(128|63&m)<<r[3&d++]);C+=d-j,j=d-64,B==T&&(s[d>>2]|=n[3&d],++B),p=s[16],B>T&&56>d&&(s[15]=C<<3,A=!0);var F=o,S=f,N=u,P=a,M=h,D=c,K=l,R=v;for(y=16;64>y;++y)E=s[y-15],g=(E>>>7|E<<25)^(E>>>18|E<<14)^E>>>3,E=s[y-2],b=(E>>>17|E<<15)^(E>>>19|E<<13)^E>>>10,s[y]=s[y-16]+g+s[y-7]+b<<0;for(k=S&N,y=0;64>y;y+=4)O?(x=704751109,E=s[0]-210244248,R=E-1521486534<<0,P=E+143694565<<0,O=!1):(g=(F>>>2|F<<30)^(F>>>13|F<<19)^(F>>>22|F<<10),b=(M>>>6|M<<26)^(M>>>11|M<<21)^(M>>>25|M<<7),x=F&S,w=x^F&N^k,L=M&D^~M&K,E=R+b+L+i[y]+s[y],_=g+w,R=P+E<<0,P=E+_<<0),g=(P>>>2|P<<30)^(P>>>13|P<<19)^(P>>>22|P<<10),b=(R>>>6|R<<26)^(R>>>11|R<<21)^(R>>>25|R<<7),I=P&F,w=I^P&S^x,L=R&M^~R&D,E=K+b+L+i[y+1]+s[y+1],_=g+w,K=N+E<<0,N=E+_<<0,g=(N>>>2|N<<30)^(N>>>13|N<<19)^(N>>>22|N<<10),b=(K>>>6|K<<26)^(K>>>11|K<<21)^(K>>>25|K<<7),U=N&P,w=U^N&F^I,L=K&R^~K&M,E=D+b+L+i[y+2]+s[y+2],_=g+w,D=S+E<<0,S=E+_<<0,g=(S>>>2|S<<30)^(S>>>13|S<<19)^(S>>>22|S<<10),b=(D>>>6|D<<26)^(D>>>11|D<<21)^(D>>>25|D<<7),k=S&N,w=k^S&P^U,L=D&K^~D&R,E=M+b+L+i[y+3]+s[y+3],_=g+w,M=F+E<<0,F=E+_<<0;o=o+F<<0,f=f+S<<0,u=u+N<<0,a=a+P<<0,h=h+M<<0,c=c+D<<0,l=l+K<<0,v=v+R<<0}while(!A);var H=new Uint8Array(32);return H[0]=o>>24&255,H[1]=o>>16&255,H[2]=o>>8&255,H[3]=255&o,H[4]=f>>24&255,H[5]=f>>16&255,H[6]=f>>8&255,H[7]=255&f,H[8]=u>>24&255,H[9]=u>>16&255,H[10]=u>>8&255,H[11]=255&u,H[12]=a>>24&255,H[13]=a>>16&255,H[14]=a>>8&255,H[15]=255&a,H[16]=h>>24&255,H[17]=h>>16&255,H[18]=h>>8&255,H[19]=255&h,H[20]=c>>24&255,H[21]=c>>16&255,H[22]=c>>8&255,H[23]=255&c,H[24]=l>>24&255,H[25]=l>>16&255,H[26]=l>>8&255,H[27]=255&l,H[28]=v>>24&255,H[29]=v>>16&255,H[30]=v>>8&255,H[31]=255&v,H}},{}]},{},[17]);